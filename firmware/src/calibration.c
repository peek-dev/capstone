/**
 * Copyright (C) 2024 John E. Berberian, Jr.
 *
 * TODO: add about one sentence for what this source file does
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */
#include "config.h"
#include "calibration.h"
#include "assert.h"

// Lower bounds for hall effect sensor reading bins.
const uint16_t bins[8][8][13] =
{{{   0,  636, 1284, 1517, 1693, 1845, 1981, 2124, 2262, 2398, 2586, 2858, 3540},
  {   0,  659, 1318, 1534, 1702, 1849, 1982, 2119, 2254, 2376, 2576, 2824, 3522},
  {   0,  703, 1344, 1540, 1706, 1852, 1982, 2119, 2250, 2377, 2565, 2821, 3514},
  {   0,  671, 1316, 1508, 1684, 1834, 1970, 2110, 2244, 2374, 2572, 2846, 3537},
  {   0,  956, 1379, 1565, 1724, 1849, 1975, 2101, 2228, 2328, 2482, 2674, 3178},
  {   0,  871, 1386, 1585, 1748, 1874, 2004, 2136, 2266, 2374, 2532, 2756, 3328},
  {   0,  619, 1245, 1488, 1685, 1842, 1990, 2140, 2288, 2424, 2630, 2914, 3599},
  {   0,  567, 1135, 1413, 1643, 1818, 1978, 2136, 2302, 2449, 2684, 3006, 3636},},

 {{   0,  540, 1107, 1395, 1630, 1809, 1972, 2136, 2305, 2464, 2709, 3049, 3674},
  {   0,  495, 1056, 1354, 1606, 1793, 1962, 2130, 2304, 2472, 2718, 3088, 3694},
  {   0,  541, 1127, 1412, 1640, 1826, 1990, 2150, 2318, 2486, 2730, 3070, 3674},
  {   0,  593, 1221, 1471, 1669, 1836, 1982, 2130, 2280, 2436, 2658, 2966, 3619},
  {   0,  556, 1120, 1406, 1638, 1812, 1972, 2133, 2296, 2454, 2686, 3006, 3666},
  {   0,  557, 1168, 1429, 1656, 1822, 1976, 2134, 2295, 2444, 2667, 2962, 3642},
  {   0,  541, 1120, 1404, 1630, 1802, 1957, 2116, 2280, 2430, 2656, 2962, 3634},
  {   0,  590, 1218, 1458, 1658, 1814, 1961, 2110, 2262, 2401, 2604, 2894, 3581},},

 {{   0,  599, 1229, 1470, 1676, 1842, 1990, 2142, 2294, 2438, 2642, 2937, 3602},
  {   0,  535, 1113, 1401, 1628, 1804, 1968, 2131, 2294, 2456, 2692, 3014, 3646},
  {   0,  542, 1143, 1428, 1654, 1830, 1990, 2154, 2317, 2474, 2704, 3029, 3670},
  {   0,  546, 1133, 1404, 1623, 1796, 1952, 2108, 2272, 2426, 2650, 2965, 3618},
  {   0,  547, 1151, 1419, 1640, 1812, 1970, 2128, 2289, 2437, 2670, 2980, 3636},
  {   0,  537, 1132, 1416, 1632, 1802, 1962, 2120, 2282, 2436, 2658, 2979, 3634},
  {   0,  598, 1225, 1478, 1673, 1831, 1978, 2126, 2274, 2414, 2618, 2884, 3576},
  {   0,  591, 1222, 1476, 1680, 1840, 1988, 2140, 2294, 2434, 2647, 2928, 3601},},

 {{   0,  609, 1221, 1474, 1674, 1834, 1984, 2132, 2286, 2409, 2638, 2923, 3593},
  {   0,  574, 1166, 1431, 1646, 1812, 1964, 2118, 2270, 2422, 2646, 2950, 3606},
  {   0,  641, 1270, 1508, 1693, 1841, 1982, 2128, 2276, 2407, 2604, 2867, 3554},
  {   0,  829, 1411, 1593, 1738, 1863, 1982, 2106, 2232, 2338, 2490, 2694, 3330},
  {   0,  931, 1439, 1617, 1757, 1870, 1991, 2114, 2234, 2342, 2488, 2682, 3254},
  {   0,  907, 1456, 1617, 1757, 1872, 1992, 2116, 2233, 2338, 2482, 2680, 3298},
  {   0,  713, 1384, 1578, 1744, 1868, 1996, 2129, 2260, 2380, 2548, 2766, 3476},
  {   0,  648, 1311, 1522, 1695, 1830, 1966, 2100, 2236, 2366, 2544, 2774, 3511},},

 {{   0,  609, 1252, 1499, 1688, 1843, 1989, 2131, 2263, 2403, 2569, 2889, 3558},
  {   0,  773, 1342, 1572, 1726, 1873, 1991, 2122, 2252, 2360, 2562, 2818, 3442},
  {   0,  659, 1286, 1528, 1709, 1865, 1990, 2125, 2260, 2390, 2563, 2848, 3462},
  {   0,  394, 1086, 1441, 1658, 1837, 1990, 2143, 2298, 2450, 2702, 3015, 3652},
  {   0,  509, 1049, 1442, 1666, 1829, 1984, 2140, 2273, 2456, 2678, 3034, 3607},
  {   0,  656, 1251, 1500, 1694, 1847, 1973, 2116, 2230, 2397, 2605, 2866, 3439},
  {   0,  818, 1398, 1588, 1759, 1869, 2005, 2134, 2262, 2377, 2542, 2764, 3344},
  {   0,  856, 1377, 1577, 1738, 1869, 1993, 2129, 2248, 2361, 2540, 2746, 3324},},

 {{   0,  854, 1442, 1621, 1750, 1864, 1984, 2104, 2230, 2331, 2449, 2683, 3265},
  {   0,  935, 1462, 1634, 1761, 1875, 1997, 2124, 2243, 2343, 2491, 2681, 3251},
  {   0,  566, 1259, 1510, 1712, 1858, 2000, 2140, 2277, 2411, 2582, 2900, 3623},
  {   0,  526, 1181, 1453, 1672, 1831, 1982, 2126, 2268, 2409, 2635, 2917, 3649},
  {   0,  574, 1230, 1529, 1688, 1841, 1986, 2120, 2265, 2404, 2607, 2871, 3615},
  {   0,  566, 1208, 1465, 1685, 1840, 1969, 2108, 2246, 2383, 2598, 2850, 3602},
  {   0,  504, 1144, 1429, 1662, 1824, 1980, 2134, 2285, 2435, 2647, 2966, 3672},
  {   0,  568, 1216, 1480, 1683, 1834, 1983, 2136, 2287, 2430, 2606, 2919, 3618},},

 {{   0,  601, 1273, 1509, 1698, 1823, 1966, 2110, 2254, 2371, 2540, 2819, 3564},
  {   0,  534, 1185, 1471, 1675, 1824, 1978, 2132, 2285, 2423, 2639, 2946, 3654},
  {   0,  560, 1221, 1473, 1689, 1836, 1982, 2127, 2274, 2414, 2625, 2902, 3633},
  {   0,  549, 1247, 1500, 1708, 1842, 1988, 2131, 2274, 2410, 2588, 2904, 3646},
  {   0,  506, 1138, 1447, 1678, 1842, 1984, 2130, 2274, 2426, 2654, 2986, 3693},
  {   0,  568, 1201, 1460, 1696, 1842, 1977, 2116, 2252, 2397, 2599, 2919, 3614},
  {   0,  499, 1129, 1404, 1645, 1816, 1970, 2122, 2278, 2422, 2635, 2989, 3673},
  {   0,  486, 1119, 1407, 1642, 1800, 1958, 2113, 2270, 2425, 2641, 2972, 3669},},

 {{   0,  566, 1249, 1543, 1693, 1832, 1979, 2128, 2280, 2411, 2594, 2890, 3626},
  {   0,  562, 1243, 1482, 1690, 1832, 1978, 2125, 2274, 2392, 2607, 2894, 3618},
  {   0,  571, 1273, 1510, 1692, 1834, 1976, 2114, 2253, 2393, 2599, 2867, 3594},
  {   0,  482, 1160, 1416, 1678, 1814, 1968, 2119, 2276, 2433, 2657, 2969, 3689},
  {   0,  683, 1318, 1567, 1724, 1838, 1974, 2116, 2257, 2365, 2534, 2750, 3519},
  {   0,  500, 1135, 1429, 1646, 1822, 1966, 2112, 2262, 2404, 2634, 2970, 3665},
  {   0,  472, 1093, 1412, 1615, 1792, 1956, 2113, 2277, 2433, 2646, 3005, 3699},
  {   0,  523, 1148, 1451, 1634, 1804, 1957, 2114, 2270, 2416, 2633, 2949, 3641}}};

const uint16_t *GetBins(uint8_t row, uint8_t col) {
    assert(row < 8 && col < 8);
    return bins[row][col];
  }
